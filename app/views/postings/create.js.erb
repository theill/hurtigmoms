<%- if @posting.errors.empty? %>
  $("#postings").prepend("<%= escape_javascript(render(@posting)) %>");
  $("#<%= dom_id(@posting) %>").effect("highlight");
  
  // FIXME: move to live handler (use livequery?)
  $("#<%= dom_id(@posting) %>").hover(function() { $(this).addClass("hover"); }, function() { $(this).removeClass("hover"); });
  
  // reset form
  $("#posting_amount, #posting_note").val('');
  $("#posting_attachment_no").val('<%= @posting.next_attachment_no %>');
  $("#new_posting .amount-vat").text('');
  
  $("#new_posting").focusFirstFormElement();
  $("#new_posting").find('input.submit').attr('disabled', '');
<%- else -%>
  // render new form (again but now with errors)
  $("#<%= dom_id(@posting) %>").replaceWith("<%= escape_javascript(render(:partial => 'edit', :locals => { :posting => @posting })) %>");
  $("#<%= dom_id(@posting) %>").effect("highlight", {color: "#ff9999"});
  
	// rebind events
	$("#<%= dom_id(@posting) %> form").ajaxForm({ dataType: "script" });
<%- end %>